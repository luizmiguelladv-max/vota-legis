<!DOCTYPE html>
<html lang="pt-BR">
<script>
  // Carrega tema, cores e sidebar ANTES de renderizar
  (function() {
    const theme = localStorage.getItem('theme') || 'light';
    const corPrimaria = localStorage.getItem('corPrimariaAdmin') || '#1a73e8';
    const corSecundaria = localStorage.getItem('corSecundariaAdmin') || '#4285f4';
    
    document.documentElement.setAttribute('data-bs-theme', theme);
    document.documentElement.style.setProperty('--cor-primaria', corPrimaria);
    document.documentElement.style.setProperty('--cor-secundaria', corSecundaria);
    
    if (localStorage.getItem('sidebarCollapsed') === 'true') {
      document.documentElement.classList.add('sidebar-should-collapse');
    }
  })();
</script>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrfToken }}">
  <title>{{ title || 'Administração' }} - Votação Eletrônica Legislativa</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">

  {{-- Parsley Validation Styles --}}
  <style>
    .parsley-errors-list {
      list-style: none;
      padding: 0;
      margin: 0.25rem 0 0;
      font-size: 0.875rem;
      color: #dc3545;
    }
    .parsley-errors-list li {
      margin-top: 0.25rem;
    }
    input.parsley-error,
    select.parsley-error,
    textarea.parsley-error {
      border-color: #dc3545 !important;
    }
    input.parsley-success,
    select.parsley-success,
    textarea.parsley-success {
      border-color: #198754 !important;
    }
  </style>

  <style>
    :root {
      --sidebar-width: 260px;
      --sidebar-collapsed-width: 70px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    html { background-color: #f5f6fa; }
    html[data-bs-theme="dark"] { background-color: #1e2530; }

    .sidebar {
      min-height: 100vh;
      width: var(--sidebar-width);
      background: linear-gradient(180deg, var(--cor-primaria) 0%, color-mix(in srgb, var(--cor-primaria) 70%, #000) 100%);
      transition: width 0.2s ease;
      overflow-x: hidden;
      overflow-y: auto;
      flex-shrink: 0;
    }

    .sidebar.collapsed {
      width: var(--sidebar-collapsed-width);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1050;
    }

    body.sidebar-collapsed .main-content {
      margin-left: var(--sidebar-collapsed-width) !important;
    }

    .sidebar.collapsed:hover {
      width: var(--sidebar-width);
      box-shadow: 4px 0 25px rgba(0, 0, 0, 0.4);
    }

    .sidebar.collapsed:hover .nav-link {
      justify-content: flex-start;
      padding: 0.75rem 1rem;
      margin: 0.2rem 0.5rem;
    }

    .sidebar.collapsed:hover .nav-link i { margin-right: 0.75rem; }

    .sidebar.collapsed:hover .nav-link span,
    .sidebar.collapsed:hover .sidebar-section-title,
    .sidebar.collapsed:hover .sidebar-header h5,
    .sidebar.collapsed:hover .sidebar-header small,
    .sidebar.collapsed:hover .sidebar-footer { display: block; }

    html.sidebar-should-collapse .sidebar {
      width: var(--sidebar-collapsed-width);
      position: fixed;
      z-index: 1050;
    }

    html.sidebar-should-collapse .main-content {
      margin-left: var(--sidebar-collapsed-width);
    }

    html.sidebar-should-collapse .sidebar .nav-link {
      justify-content: center;
      padding: 0.75rem;
      margin: 0.2rem 0.3rem;
    }

    html.sidebar-should-collapse .sidebar .nav-link i { margin-right: 0; }

    html.sidebar-should-collapse .sidebar .nav-link span,
    html.sidebar-should-collapse .sidebar .sidebar-section-title,
    html.sidebar-should-collapse .sidebar .sidebar-header h5,
    html.sidebar-should-collapse .sidebar .sidebar-header small,
    html.sidebar-should-collapse .sidebar .sidebar-footer { display: none; }

    .sidebar .nav-link {
      color: rgba(255, 255, 255, 0.8);
      padding: 0.75rem 1rem;
      margin: 0.2rem 0.5rem;
      border-radius: 0.5rem;
      transition: all 0.2s;
      white-space: nowrap;
      display: flex;
      align-items: center;
    }

    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .sidebar .nav-link.active {
      background: rgba(255, 255, 255, 0.2);
      font-weight: 500;
    }

    .sidebar .nav-link i {
      width: 1.5rem;
      min-width: 1.5rem;
      margin-right: 0.75rem;
      font-size: 1.1rem;
      text-align: center;
    }

    .sidebar.collapsed .nav-link {
      justify-content: center;
      padding: 0.75rem;
      margin: 0.2rem 0.3rem;
    }

    .sidebar.collapsed .nav-link i { margin-right: 0; }

    .sidebar.collapsed .nav-link span,
    .sidebar.collapsed .sidebar-section-title,
    .sidebar.collapsed .sidebar-header h5,
    .sidebar.collapsed .sidebar-header small,
    .sidebar.collapsed .sidebar-footer { display: none; }

    .sidebar-header {
      padding: 1.5rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .sidebar-section-title {
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.75rem;
      padding: 0.5rem 1rem;
      margin-top: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-toggle-header {
      color: inherit;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .sidebar-toggle-header:hover { opacity: 1; }

    .main-content {
      background: #f5f6fa;
      min-height: 100vh;
      flex: 1;
    }

    .navbar-top {
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .card {
      border: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      border-radius: 0.5rem;
    }

    .btn-primary {
      background-color: var(--cor-primaria);
      border-color: var(--cor-primaria);
    }

    .btn-primary:hover {
      background-color: var(--cor-secundaria);
      border-color: var(--cor-secundaria);
    }

    a { color: var(--cor-primaria); }
    a:hover { color: var(--cor-secundaria); }

    .table th {
      font-weight: 600;
      background: #f8f9fa;
      color: #495057;
    }

    /* Dark Mode */
    [data-bs-theme="dark"] {
      --bg-dark: #1e2530;
      --bg-card: #262f3d;
      --bg-input: #2d3848;
      --border-color: #3d4a5c;
      --text-primary: #e4e6eb;
      --text-secondary: #a8b3c5;
    }

    [data-bs-theme="dark"] body { background: var(--bg-dark); color: var(--text-primary); }
    [data-bs-theme="dark"] .sidebar { background: linear-gradient(180deg, color-mix(in srgb, var(--cor-primaria) 40%, #1a2332) 0%, #1a2332 100%); }
    [data-bs-theme="dark"] .main-content { background: var(--bg-dark); }
    [data-bs-theme="dark"] .navbar-top { background: var(--bg-card); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
    [data-bs-theme="dark"] .card { background: var(--bg-card); }
    [data-bs-theme="dark"] .table th,
    [data-bs-theme="dark"] table.dataTable thead th { 
      background: #2d3848 !important; 
      color: var(--text-primary) !important; 
      border-color: var(--border-color) !important;
    }
    [data-bs-theme="dark"] .table td,
    [data-bs-theme="dark"] table.dataTable tbody td { 
      color: var(--text-secondary); 
      border-color: var(--border-color); 
      background-color: transparent !important;
    }
    [data-bs-theme="dark"] table.dataTable tbody tr {
      background-color: var(--bg-card) !important;
    }
    [data-bs-theme="dark"] table.dataTable tbody tr:hover {
      background-color: var(--bg-input) !important;
    }
    [data-bs-theme="dark"] table.dataTable tbody tr.odd {
      background-color: var(--bg-card) !important;
    }
    [data-bs-theme="dark"] table.dataTable tbody tr.even {
      background-color: rgba(45, 56, 72, 0.5) !important;
    }
    [data-bs-theme="dark"] .dataTables_empty {
      color: var(--text-secondary) !important;
      background-color: var(--bg-card) !important;
    }
    [data-bs-theme="dark"] .dataTables_wrapper .dataTables_length,
    [data-bs-theme="dark"] .dataTables_wrapper .dataTables_filter,
    [data-bs-theme="dark"] .dataTables_wrapper .dataTables_info,
    [data-bs-theme="dark"] .dataTables_wrapper .dataTables_paginate {
      color: var(--text-secondary);
    }
    [data-bs-theme="dark"] .dataTables_wrapper .dataTables_filter input,
    [data-bs-theme="dark"] .dataTables_wrapper .dataTables_length select {
      background: var(--bg-input);
      border-color: var(--border-color);
      color: var(--text-primary);
    }
    [data-bs-theme="dark"] .page-link {
      background: var(--bg-input);
      border-color: var(--border-color);
      color: var(--text-secondary);
    }
    [data-bs-theme="dark"] .page-item.active .page-link {
      background: var(--cor-primaria);
      border-color: var(--cor-primaria);
    }
    [data-bs-theme="dark"] .page-item.disabled .page-link {
      background: var(--bg-card);
      border-color: var(--border-color);
      color: var(--text-secondary);
      opacity: 0.5;
    }
    [data-bs-theme="dark"] .form-control, [data-bs-theme="dark"] .form-select { background: var(--bg-input); border-color: var(--border-color); color: var(--text-primary); }
    [data-bs-theme="dark"] .form-control:focus, [data-bs-theme="dark"] .form-select:focus { background: var(--bg-input); border-color: var(--cor-primaria); color: var(--text-primary); }
    [data-bs-theme="dark"] .modal-content { background: var(--bg-card); border-color: var(--border-color); }
    [data-bs-theme="dark"] .modal-header, [data-bs-theme="dark"] .modal-footer { border-color: var(--border-color); }
    [data-bs-theme="dark"] .btn-close { filter: invert(1); }
    [data-bs-theme="dark"] .list-group-item { background-color: var(--bg-card); border-color: var(--border-color); color: var(--text-primary); }
    [data-bs-theme="dark"] .list-group-item.active { background-color: color-mix(in srgb, var(--cor-primaria) 30%, var(--bg-card)); border-color: var(--cor-primaria); }
    [data-bs-theme="dark"] .card-header { background-color: var(--bg-input); border-color: var(--border-color); }
    [data-bs-theme="dark"] .text-muted { color: var(--text-secondary) !important; }

    /* Select2 Dark Mode */
    [data-bs-theme="dark"] .select2-container--bootstrap-5 .select2-selection {
      background-color: var(--bg-input) !important;
      border-color: var(--border-color) !important;
      color: var(--text-primary) !important;
    }
    [data-bs-theme="dark"] .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered {
      color: var(--text-primary) !important;
    }
    [data-bs-theme="dark"] .select2-container--bootstrap-5 .select2-dropdown {
      background-color: var(--bg-card) !important;
      border-color: var(--border-color) !important;
    }
    [data-bs-theme="dark"] .select2-container--bootstrap-5 .select2-results__option {
      background-color: var(--bg-card) !important;
      color: var(--text-primary) !important;
    }
    [data-bs-theme="dark"] .select2-container--bootstrap-5 .select2-results__option--highlighted {
      background-color: var(--cor-primaria) !important;
      color: #fff !important;
    }
    [data-bs-theme="dark"] .select2-container--bootstrap-5 .select2-search__field {
      background-color: var(--bg-input) !important;
      border-color: var(--border-color) !important;
      color: var(--text-primary) !important;
    }

        @media (max-width: 991px) {
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        height: 100dvh; /* Dynamic viewport height para mobile */
        max-height: -webkit-fill-available;
        z-index: 1050;
        transform: translateX(-100%);
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        display: flex;
        flex-direction: column;
      }
      .sidebar.show { transform: translateX(0); }
      .sidebar .nav.flex-column {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 20px;
      }
      .sidebar-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1040;
        display: none;
      }
      .sidebar-overlay.show { display: block; }
    }
  </style>
</head>
<body>
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

  <div class="d-flex">
    {{-- Sidebar Admin --}}
    <nav class="sidebar d-flex flex-column" id="sidebar">
      <div class="sidebar-header text-center">
        <i class="bi bi-gear-wide-connected text-white" style="font-size: 2rem;"></i>
        <h5 class="text-white mb-0 mt-2">Administração</h5>
        <small class="text-white-50">Votação Eletrônica</small>
      </div>

      <ul class="nav flex-column mt-3 flex-grow-1">
        <li class="sidebar-section-title">MUNICÍPIOS</li>
        <li class="nav-item">
          <a class="nav-link {{ request.url() === '/admin/municipios' ? 'active' : '' }}" href="/admin/municipios" title="Gerenciar Municípios">
            <i class="bi bi-buildings"></i>
            <span>Gerenciar Municípios</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/selecionar-municipio" title="Acessar Município">
            <i class="bi bi-box-arrow-in-right"></i>
            <span>Acessar Município</span>
          </a>
        </li>

        <li class="sidebar-section-title">SISTEMA</li>
        <li class="nav-item">
          <a class="nav-link {{ request.url() === '/admin/usuarios-master' ? 'active' : '' }}" href="/admin/usuarios-master" title="Usuários Master">
            <i class="bi bi-person-gear"></i>
            <span>Usuários Master</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{ request.url() === '/admin/auditoria' ? 'active' : '' }}" href="/admin/auditoria" title="Auditoria">
            <i class="bi bi-shield-check"></i>
            <span>Auditoria</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{ request.url() === '/admin/monitoramento' ? 'active' : '' }}" href="/admin/monitoramento" title="Monitoramento">
            <i class="bi bi-activity"></i>
            <span>Monitoramento</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{ request.url() === '/admin/backups' ? 'active' : '' }}" href="/admin/backups" title="Backups">
            <i class="bi bi-cloud-download"></i>
            <span>Backups</span>
          </a>
        </li>

        <li class="sidebar-section-title">CONFIGURAÇÕES</li>
        <li class="nav-item">
          <a class="nav-link {{ request.url() === '/admin/configuracoes' ? 'active' : '' }}" href="/admin/configuracoes" title="Aparência">
            <i class="bi bi-palette"></i>
            <span>Aparência</span>
          </a>
        </li>
      </ul>

      <div class="sidebar-footer mt-auto">
        <small class="text-white-50">v1.0.0 - AdonisJS</small>
      </div>
    </nav>

    {{-- Main Content --}}
    <div class="main-content flex-grow-1">
      <nav class="navbar navbar-top navbar-expand-lg px-4 py-2">
        <button class="btn btn-link d-lg-none p-0 me-3" type="button" onclick="toggleSidebar()">
          <i class="bi bi-list fs-4"></i>
        </button>

        <button class="btn btn-link d-none d-lg-flex p-0 me-3 sidebar-toggle-header" type="button" onclick="toggleSidebarCollapse()" title="Recolher/Expandir menu">
          <i class="bi bi-list fs-4"></i>
        </button>

        <div class="ms-auto d-flex align-items-center gap-3">
          <button class="btn btn-link text-muted p-0" onclick="toggleDarkMode()" title="Alternar tema">
            <i class="bi bi-moon-stars fs-5" id="darkModeIcon"></i>
          </button>

          <div class="dropdown">
            <button class="btn btn-link text-decoration-none dropdown-toggle" type="button" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-1"></i>
              {{ usuario?.nome || 'Admin' }}
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><span class="dropdown-item-text text-muted small">{{ usuario?.email }}</span></li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item text-danger" href="/logout">
                  <i class="bi bi-box-arrow-right me-2"></i>Sair
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <main class="p-4">
        {{{ await $slots.content() }}}
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

  {{-- Parsley Validation --}}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.9.2/parsley.min.js"></script>

  <script>
    // Parsley pt-BR locale (inline para evitar erro de CDN)
    window.Parsley.addMessages('pt-br', {
      defaultMessage: "Este valor parece ser invalido.",
      type: {
        email: "Este campo deve ser um email valido.",
        url: "Este campo deve ser uma URL valida.",
        number: "Este campo deve ser um numero valido.",
        integer: "Este campo deve ser um inteiro valido.",
        digits: "Este campo deve conter apenas digitos.",
        alphanum: "Este campo deve ser alfanumerico."
      },
      notblank: "Este campo nao pode ficar vazio.",
      required: "Este campo e obrigatorio.",
      pattern: "Este valor parece ser invalido.",
      min: "Este valor deve ser maior ou igual a %s.",
      max: "Este valor deve ser menor ou igual a %s.",
      range: "Este valor deve estar entre %s e %s.",
      minlength: "Este campo deve ter pelo menos %s caracteres.",
      maxlength: "Este campo deve ter no maximo %s caracteres.",
      length: "Este campo deve ter entre %s e %s caracteres.",
      mincheck: "Voce deve selecionar pelo menos %s opcoes.",
      maxcheck: "Voce deve selecionar no maximo %s opcoes.",
      check: "Voce deve selecionar entre %s e %s opcoes.",
      equalto: "Este valor deve ser identico."
    });
    window.Parsley.setLocale('pt-br');

    // Parsley default config
    window.Parsley.options.errorClass = 'parsley-error';
    window.Parsley.options.successClass = 'parsley-success';
    window.Parsley.options.errorsWrapper = '<ul class="parsley-errors-list"></ul>';
    window.Parsley.options.errorTemplate = '<li></li>';

    // Inicializa Parsley em todos os formulários com data-parsley-validate
    $(document).ready(function() {
      $('form[data-parsley-validate]').parsley();
    });

    // Função para remover acentos
    function removerAcentos(str) {
      return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    }

    // Transforma texto em maiúsculas e remove acentos (exceto login, senha, email)
    $(document).on('input', 'input[type="text"], textarea', function() {
      const campo = $(this);
      const name = campo.attr('name') || '';
      const id = campo.attr('id') || '';
      const type = campo.attr('type') || '';

      // Campos que NÃO devem ser transformados
      const camposExcluidos = ['login', 'senha', 'password', 'email', 'slug', 'db', 'token'];
      const deveExcluir = camposExcluidos.some(exc =>
        name.toLowerCase().includes(exc) ||
        id.toLowerCase().includes(exc) ||
        type === 'password' ||
        type === 'email'
      );

      if (!deveExcluir) {
        const cursorPos = this.selectionStart;
        const valorOriginal = campo.val();
        const valorNovo = removerAcentos(valorOriginal).toUpperCase();

        if (valorOriginal !== valorNovo) {
          campo.val(valorNovo);
          // Restaura posição do cursor
          this.setSelectionRange(cursorPos, cursorPos);
        }
      }
    });
  </script>

  <script>
    $.ajaxSetup({
      headers: { 'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.content }
    });

    toastr.options = {
      closeButton: true,
      progressBar: true,
      positionClass: 'toast-top-right',
      timeOut: 3000
    };

    $.fn.select2.defaults.set('theme', 'bootstrap-5');

    $.extend(true, $.fn.dataTable.defaults, {
      language: {
        "sEmptyTable": "Nenhum registro encontrado",
        "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
        "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
        "sInfoFiltered": "(Filtrados de _MAX_ registros)",
        "sLengthMenu": "_MENU_ resultados por página",
        "sLoadingRecords": "Carregando...",
        "sProcessing": "Processando...",
        "sZeroRecords": "Nenhum registro encontrado",
        "sSearch": "Pesquisar",
        "oPaginate": { "sNext": "Próximo", "sPrevious": "Anterior", "sFirst": "Primeiro", "sLast": "Último" }
      },
      processing: true,
      serverSide: false
    });

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('show');
      document.getElementById('sidebarOverlay').classList.toggle('show');
    }

    function toggleSidebarCollapse() {
      const sidebar = document.getElementById('sidebar');
      const isCollapsed = sidebar.classList.toggle('collapsed');
      document.body.classList.toggle('sidebar-collapsed', isCollapsed);
      localStorage.setItem('sidebarCollapsed', isCollapsed);
    }

    function toggleDarkMode() {
      const html = document.documentElement;
      const isDark = html.getAttribute('data-bs-theme') === 'dark';
      html.setAttribute('data-bs-theme', isDark ? 'light' : 'dark');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
      updateDarkModeIcon();
    }

    function updateDarkModeIcon() {
      const isDark = document.documentElement.getAttribute('data-bs-theme') === 'dark';
      const icon = document.getElementById('darkModeIcon');
      if (icon) icon.className = isDark ? 'bi bi-sun fs-5' : 'bi bi-moon-stars fs-5';
    }

    document.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-bs-theme', savedTheme);
        updateDarkModeIcon();
      }

      const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
      const sidebar = document.getElementById('sidebar');
      if (sidebarCollapsed && sidebar) {
        sidebar.classList.add('collapsed');
        document.body.classList.add('sidebar-collapsed');
      }
      document.documentElement.classList.remove('sidebar-should-collapse');
    });

    // Função global de confirmação
    window.confirmar = function(mensagem, opcoes = {}) {
      return new Promise((resolve) => {
        const titulo = opcoes.titulo || 'Confirmação';
        const tipo = opcoes.tipo || 'warning';
        const textoBtnConfirmar = opcoes.textoBtnConfirmar || 'Confirmar';
        const textoBtnCancelar = opcoes.textoBtnCancelar || 'Cancelar';

        const icones = {
          danger: 'bi-exclamation-triangle-fill text-danger',
          warning: 'bi-exclamation-circle-fill text-warning',
          info: 'bi-info-circle-fill text-info',
          success: 'bi-check-circle-fill text-success'
        };

        const btnClasses = {
          danger: 'btn-danger',
          warning: 'btn-warning',
          info: 'btn-primary',
          success: 'btn-success'
        };

        $('#modalConfirmTitle').text(titulo);
        $('#modalConfirmMessage').text(mensagem);
        $('#modalConfirmIcon').attr('class', 'bi me-3 ' + (icones[tipo] || icones.warning)).css('font-size', '2rem');
        $('#modalConfirmBtnOk').text(textoBtnConfirmar).attr('class', 'btn ' + (btnClasses[tipo] || 'btn-primary'));
        $('#modalConfirmBtnCancel').text(textoBtnCancelar);

        const modal = new bootstrap.Modal(document.getElementById('modalConfirm'));

        $('#modalConfirmBtnOk').off('click').on('click', function() {
          modal.hide();
          resolve(true);
        });

        $('#modalConfirm').off('hidden.bs.modal.confirm').on('hidden.bs.modal.confirm', function() {
          resolve(false);
        });

        modal.show();
      });
    };
  </script>

  {{-- Modal de Confirmação Global --}}
  <div class="modal fade" id="modalConfirm" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="modalConfirmTitle">Confirmação</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body d-flex align-items-center">
          <i class="bi bi-exclamation-circle-fill text-warning me-3" id="modalConfirmIcon" style="font-size: 2rem;"></i>
          <span id="modalConfirmMessage"></span>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="modalConfirmBtnCancel">Cancelar</button>
          <button type="button" class="btn btn-primary" id="modalConfirmBtnOk">Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  {{{ await $slots.scripts() }}}
</body>
</html>
