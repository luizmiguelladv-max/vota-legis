<!DOCTYPE html>
<html lang="pt-BR">
<head>
  @include('partials/head')
</head>
<body>
  <div class="d-flex">
    @include('partials/sidebar')

    <div class="main-content flex-grow-1">
      @include('partials/navbar')

      <main class="p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h4 class="section-title mb-1">
              <i class="bi bi-activity me-2"></i>Monitoramento
            </h4>
            <p class="text-muted mb-0">Status do sistema e recursos</p>
          </div>
          <button class="btn btn-outline-primary" onclick="atualizarStatus()">
            <i class="bi bi-arrow-repeat me-2"></i>Atualizar
          </button>
        </div>

        <!-- Cards de Status -->
        <div class="row g-4 mb-4">
          <div class="col-md-3">
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Servidor</h6>
                    <span class="badge bg-success fs-6" id="statusServidor">Online</span>
                  </div>
                  <i class="bi bi-server text-success fs-1 opacity-50"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Banco de Dados</h6>
                    <span class="badge bg-success fs-6" id="statusBanco">Conectado</span>
                  </div>
                  <i class="bi bi-database text-success fs-1 opacity-50"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Camaras</h6>
                    <span class="fs-4 fw-bold" id="totalCamaras">{{ totalCamaras || 0 }}</span>
                  </div>
                  <i class="bi bi-buildings text-primary fs-1 opacity-50"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Usuarios Ativos</h6>
                    <span class="fs-4 fw-bold" id="usuariosAtivos">{{ usuariosAtivos || 0 }}</span>
                  </div>
                  <i class="bi bi-people text-warning fs-1 opacity-50"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row g-4">
          <!-- Status das Câmaras -->
          <div class="col-lg-6">
            <div class="card">
              <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-buildings me-2"></i>Status das Camaras</h6>
              </div>
              <div class="card-body">
                <table class="table table-sm" id="tabelaCamarasStatus">
                  <thead>
                    <tr>
                      <th>Camara</th>
                      <th>Schema</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    @if(camaras && camaras.length > 0)
                      @each(camara in camaras)
                        <tr>
                          <td>{{ camara.nome }}</td>
                          <td><code>camara_{{ camara.id }}</code></td>
                          <td>
                            @if(camara.banco_criado)
                              <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Ativo</span>
                            @else
                              <span class="badge bg-warning"><i class="bi bi-clock me-1"></i>Pendente</span>
                            @end
                          </td>
                        </tr>
                      @end
                    @else
                      <tr>
                        <td colspan="3" class="text-center text-muted">Nenhuma camara cadastrada</td>
                      </tr>
                    @end
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Últimas Ações -->
          <div class="col-lg-6">
            <div class="card">
              <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-clock-history me-2"></i>Ultimas Acoes</h6>
              </div>
              <div class="card-body">
                <div class="list-group list-group-flush" id="ultimasAcoes">
                  <div class="text-center text-muted py-4">
                    <i class="bi bi-inbox fs-1"></i>
                    <p class="mb-0 mt-2">Nenhuma acao recente</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Informações do Sistema -->
        <div class="row g-4 mt-2">
          <div class="col-12">
            <div class="card">
              <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Informacoes do Sistema</h6>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-4">
                    <p class="mb-1"><strong>Versao:</strong> 1.0.0</p>
                    <p class="mb-1"><strong>Framework:</strong> AdonisJS 6</p>
                  </div>
                  <div class="col-md-4">
                    <p class="mb-1"><strong>Node.js:</strong> v20.x</p>
                    <p class="mb-1"><strong>Banco:</strong> PostgreSQL (Supabase)</p>
                  </div>
                  <div class="col-md-4">
                    <p class="mb-1"><strong>Ambiente:</strong> Producao</p>
                    <p class="mb-1"><strong>Servidor:</strong> Docker + Coolify</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  @include('partials/scripts')

  <script>
    function atualizarStatus() {
      location.reload();
    }
  </script>
</body>
</html>
