<!DOCTYPE html>
<html lang="pt-BR">
<head>
  @include('partials/head')
</head>
<body>
  <div class="d-flex">
    @include('partials/sidebar')

    <div class="main-content flex-grow-1">
      @include('partials/navbar')

      <main class="p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h4 class="section-title mb-1">
              <i class="bi bi-person-gear me-2"></i>Usuarios Master
            </h4>
            <p class="text-muted mb-0">Gerenciar administradores do sistema</p>
          </div>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalNovoUsuario">
            <i class="bi bi-plus me-2"></i>Novo Usuario
          </button>
        </div>

        @if(flashMessages.has('success'))
          <div class="alert alert-success alert-dismissible fade show">
            <i class="bi bi-check-circle me-2"></i>{{ flashMessages.get('success') }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        @endif

        @if(flashMessages.has('error'))
          <div class="alert alert-danger alert-dismissible fade show">
            <i class="bi bi-exclamation-circle me-2"></i>{{ flashMessages.get('error') }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        @endif

        <div class="card">
          <div class="card-body">
            <table class="table table-hover" id="tabelaUsuarios">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Login</th>
                  <th>Email</th>
                  <th>Perfil</th>
                  <th>Status</th>
                  <th>Ultimo Acesso</th>
                  <th width="100">Acoes</th>
                </tr>
              </thead>
              <tbody>
                @if(usuarios && usuarios.length > 0)
                  @each(usuario in usuarios)
                    <tr>
                      <td>
                        <div class="d-flex align-items-center">
                          <div class="avatar-sm me-2">
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 35px; height: 35px;">
                              {{ usuario.nome?.charAt(0)?.toUpperCase() || 'U' }}
                            </div>
                          </div>
                          {{ usuario.nome }}
                        </div>
                      </td>
                      <td>{{ usuario.login }}</td>
                      <td>{{ usuario.email || '-' }}</td>
                      <td>
                        @if(usuario.perfil?.nome === 'Super Admin')
                          <span class="badge bg-danger">{{ usuario.perfil?.nome }}</span>
                        @elseif(usuario.perfil?.nome === 'Admin')
                          <span class="badge bg-primary">{{ usuario.perfil?.nome }}</span>
                        @else
                          <span class="badge bg-secondary">{{ usuario.perfil?.nome || 'Usuario' }}</span>
                        @end
                      </td>
                      <td>
                        @if(usuario.ativo)
                          <span class="badge bg-success">Ativo</span>
                        @else
                          <span class="badge bg-danger">Inativo</span>
                        @end
                      </td>
                      <td>{{ usuario.ultimo_acesso || 'Nunca' }}</td>
                      <td>
                        <div class="dropdown">
                          <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots"></i>
                          </button>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-pencil me-2"></i>Editar</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-key me-2"></i>Redefinir Senha</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-trash me-2"></i>Excluir</a></li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                  @end
                @else
                  <tr>
                    <td colspan="7" class="text-center text-muted py-4">
                      <i class="bi bi-people fs-1"></i>
                      <p class="mb-0 mt-2">Nenhum usuario cadastrado</p>
                    </td>
                  </tr>
                @end
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Modal Novo Usuario -->
  <div class="modal fade" id="modalNovoUsuario" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-person-plus me-2"></i>Novo Usuario Master</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form action="/admin/usuarios" method="POST">
          {{ csrfField() }}
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Nome Completo *</label>
              <input type="text" class="form-control" name="nome" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Login *</label>
              <input type="text" class="form-control" name="login" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" name="email">
            </div>
            <div class="mb-3">
              <label class="form-label">Senha *</label>
              <input type="password" class="form-control" name="senha" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Perfil *</label>
              <select class="form-select" name="perfil_id" required>
                <option value="">Selecione...</option>
                <option value="1">Super Admin</option>
                <option value="2">Admin</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-check me-2"></i>Salvar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  @include('partials/scripts')
</body>
</html>
