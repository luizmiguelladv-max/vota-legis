<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configurar Leitor Biométrico - Ponto Eletrônico</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #fff;
    }
    .card {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
    }
    .card-header {
      background: rgba(255,255,255,0.1);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .step-number {
      width: 40px;
      height: 40px;
      background: #0d6efd;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    .step-item {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .btn-download {
      background: linear-gradient(135deg, #00c853 0%, #00e676 100%);
      border: none;
      font-size: 1.2rem;
      padding: 1rem 2rem;
    }
    .btn-download:hover {
      background: linear-gradient(135deg, #00e676 0%, #69f0ae 100%);
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0,200,83,0.4);
    }
    .status-card {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 1rem;
    }
    .status-online {
      color: #00e676;
    }
    .status-offline {
      color: #ff5252;
    }
    .requisitos-list li {
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .requisitos-list li:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        <!-- Header -->
        <div class="text-center mb-5">
          <i class="bi bi-fingerprint display-1 text-primary mb-3"></i>
          <h1 class="display-5 fw-bold">Configurar Leitor Biométrico</h1>
          <p class="lead text-white-50">Configure o leitor de digitais Futronic FS80H no seu computador</p>
        </div>

        <!-- Status Card -->
        <div class="card mb-4">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h5 class="mb-1">Status do Leitor</h5>
                <p class="mb-0 text-white-50" id="statusTexto">Verificando...</p>
              </div>
              <div id="statusIcon">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Verificando...</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Download Card -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-download me-2"></i>Download do Software</h5>
          </div>
          <div class="card-body text-center py-4">
            <p class="mb-4">Baixe e instale o software para conectar o leitor biométrico ao sistema.</p>
            <a href="/futronic-api.zip" class="btn btn-download btn-lg text-white" download>
              <i class="bi bi-download me-2"></i>Baixar Futronic API
            </a>
            <p class="mt-3 text-white-50 small">
              <i class="bi bi-file-earmark-zip me-1"></i>futronic-api.zip (5 KB)
            </p>
          </div>
        </div>

        <!-- Instruções -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-list-ol me-2"></i>Passo a Passo</h5>
          </div>
          <div class="card-body">

            <div class="step-item">
              <div class="step-number">1</div>
              <div>
                <h6 class="mb-1">Baixe o arquivo</h6>
                <p class="text-white-50 mb-0">Clique no botão acima para baixar o arquivo <code>futronic-api.zip</code></p>
              </div>
            </div>

            <div class="step-item">
              <div class="step-number">2</div>
              <div>
                <h6 class="mb-1">Extraia os arquivos</h6>
                <p class="text-white-50 mb-0">Clique com o botão direito no arquivo e selecione <strong>"Extrair Tudo"</strong>. Escolha uma pasta como <code>C:\FutronicAPI</code></p>
              </div>
            </div>

            <div class="step-item">
              <div class="step-number">3</div>
              <div>
                <h6 class="mb-1">Conecte o leitor USB</h6>
                <p class="text-white-50 mb-0">Conecte o leitor Futronic FS80H na porta USB do computador. Aguarde o Windows instalar o driver automaticamente.</p>
              </div>
            </div>

            <div class="step-item">
              <div class="step-number">4</div>
              <div>
                <h6 class="mb-1">Execute o programa</h6>
                <p class="text-white-50 mb-0">Abra a pasta extraída e dê <strong>duplo clique</strong> em <code>iniciar.bat</code>. Uma janela preta vai abrir - <strong>mantenha ela aberta</strong>.</p>
              </div>
            </div>

            <div class="step-item">
              <div class="step-number">5</div>
              <div>
                <h6 class="mb-1">Pronto!</h6>
                <p class="text-white-50 mb-0">O sistema vai detectar o leitor automaticamente. Você pode voltar para a página de funcionários e cadastrar digitais.</p>
              </div>
            </div>

          </div>
        </div>

        <!-- Requisitos -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-check2-circle me-2"></i>Requisitos</h5>
          </div>
          <div class="card-body">
            <ul class="list-unstyled requisitos-list mb-0">
              <li><i class="bi bi-windows text-info me-2"></i>Windows 10 ou 11</li>
              <li><i class="bi bi-usb-symbol text-warning me-2"></i>Leitor Futronic FS80H conectado via USB</li>
              <li><i class="bi bi-globe text-success me-2"></i>Navegador atualizado (Chrome, Edge, Firefox)</li>
            </ul>
          </div>
        </div>

        <!-- Solução de Problemas -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-wrench me-2"></i>Solução de Problemas</h5>
          </div>
          <div class="card-body">
            <div class="accordion accordion-flush" id="faqAccordion">

              <div class="accordion-item bg-transparent border-bottom border-secondary">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed bg-transparent text-white" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                    "Python não encontrado"
                  </button>
                </h2>
                <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                  <div class="accordion-body text-white-50">
                    Instale o Python de <a href="https://www.python.org/downloads/" target="_blank" class="text-info">python.org</a>.
                    <strong>Importante:</strong> Marque a opção "Add Python to PATH" durante a instalação.
                  </div>
                </div>
              </div>

              <div class="accordion-item bg-transparent border-bottom border-secondary">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed bg-transparent text-white" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                    "Dispositivo não conectado"
                  </button>
                </h2>
                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                  <div class="accordion-body text-white-50">
                    Verifique se o leitor está conectado na USB. Tente outra porta USB.
                    Se o problema persistir, reinstale o driver do Futronic.
                  </div>
                </div>
              </div>

              <div class="accordion-item bg-transparent">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed bg-transparent text-white" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                    A janela preta fecha sozinha
                  </button>
                </h2>
                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                  <div class="accordion-body text-white-50">
                    Isso indica um erro. Abra o Prompt de Comando (cmd), navegue até a pasta do programa
                    e execute <code>python main.py</code> para ver a mensagem de erro.
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Botões -->
        <div class="d-flex gap-3 justify-content-center">
          <a href="/funcionarios" class="btn btn-outline-light btn-lg">
            <i class="bi bi-arrow-left me-2"></i>Voltar para Funcionários
          </a>
          <button class="btn btn-primary btn-lg" onclick="verificarStatus()">
            <i class="bi bi-arrow-clockwise me-2"></i>Verificar Novamente
          </button>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const BIOMETRIC_API_URL = 'http://localhost:5001';

    async function verificarStatus() {
      const statusTexto = document.getElementById('statusTexto');
      const statusIcon = document.getElementById('statusIcon');

      statusIcon.innerHTML = '<div class="spinner-border text-primary" role="status"></div>';
      statusTexto.textContent = 'Verificando...';

      try {
        const response = await fetch(`${BIOMETRIC_API_URL}/`, {
          method: 'GET',
          signal: AbortSignal.timeout(3000)
        });
        const result = await response.json();

        if (result.device_connected) {
          statusTexto.innerHTML = '<span class="status-online"><i class="bi bi-check-circle-fill me-1"></i>Leitor conectado e funcionando!</span>';
          statusIcon.innerHTML = '<i class="bi bi-check-circle-fill display-4 status-online"></i>';
        } else {
          statusTexto.innerHTML = '<span class="status-offline"><i class="bi bi-exclamation-triangle-fill me-1"></i>Serviço online, mas leitor não detectado</span>';
          statusIcon.innerHTML = '<i class="bi bi-exclamation-triangle-fill display-4 text-warning"></i>';
        }
      } catch (error) {
        statusTexto.innerHTML = '<span class="status-offline"><i class="bi bi-x-circle-fill me-1"></i>Serviço não está rodando - siga as instruções abaixo</span>';
        statusIcon.innerHTML = '<i class="bi bi-x-circle-fill display-4 status-offline"></i>';
      }
    }

    // Verifica status ao carregar
    verificarStatus();

    // Verifica a cada 5 segundos
    setInterval(verificarStatus, 5000);
  </script>
</body>
</html>
